$("document").ready(function(){var palette=new Rickshaw.Color.Palette;$.each(SENSOR_VALUES,function(index,value){value.color=palette.color(),value.yFormatter=function(y){var scaled=y/value.scalingFactor;return"float"==value.valueType?scaled.toFixed(2)+value.units:parseInt(scaled)+value.units}});var graph=new Rickshaw.Graph({element:$("#sensorGraph .chart")[0],height:300,renderer:"line",series:SENSOR_VALUES});graph.render();var legend=(new Rickshaw.Graph.HoverDetail({graph:graph}),new Rickshaw.Graph.Legend({graph:graph,element:$("#sensorGraph .legend")[0]})),x_axis=(new Rickshaw.Graph.Behavior.Series.Toggle({graph:graph,legend:legend}),new Rickshaw.Graph.RangeSlider({graph:graph,element:$("#sensorGraph .slider")[0]}),new Rickshaw.Graph.Axis.Time({graph:graph}));x_axis.render(),$("#sensorGraph .fetchResults").click(function(){var self=this;$(self).hide(),$.post("/api/fetch-sensor-values",{before:FIRST_VALUE},function(data){data.result&&data.result.length>0&&($(self).show(),$.each(data.result,function(index,sensor){$.each(SENSOR_VALUES,function(index,graphSensor){sensor.name==graphSensor.name&&(graphSensor.data=sensor.data.concat(graphSensor.data))})}),FIRST_VALUE=data.result[0].data[0].x_date,graph.update())},"json")});var resizeGraph=function(){var width=$("#sensorGraph").parent().width();$("#sensorGraph .slider").width(width),graph.configure({width:width}),graph.render()};$(window).on("resize",function(){resizeGraph()}),$('.heading a[data-toggle="tab"]').on("shown.bs.tab",function(e){var href=$(e.target).attr("href");"#sensorGraphTab"==href&&resizeGraph()})});